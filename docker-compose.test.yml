services:
  # PostgreSQL Test Database
  postgres-test:
    image: postgres:16-alpine
    ports:
      - '5445:5432' # Different port from dev database (5444)
    environment:
      - POSTGRES_USER=projectfinish_test
      - POSTGRES_PASSWORD=password_test
      - POSTGRES_DB=projectfinish_test
    tmpfs:
      - /var/lib/postgresql/data # Use tmpfs for faster test DB (ephemeral)
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U projectfinish_test']
      interval: 5s
      timeout: 3s
      retries: 5
    networks:
      - projectfinish-test-network

  # Redis Test Cache
  redis-test:
    image: redis:7-alpine
    ports:
      - '6391:6379' # Different port from dev Redis (6390)
    tmpfs:
      - /data # Use tmpfs for faster test cache (ephemeral)
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 5s
      timeout: 3s
      retries: 5
    networks:
      - projectfinish-test-network
    command: redis-server

networks:
  projectfinish-test-network:
    driver: bridge
